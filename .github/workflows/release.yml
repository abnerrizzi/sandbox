name: Release
on:
  workflow_call:

env:
  DOCKER_BUILDKIT: 1

jobs:
  matrix:
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.generate.outputs.matrix }}
    steps:
    - name: Setup
      run: echo ./utils/setup.sh
    - name: Generate matrix
      id: generate
      run: echo ${{ inputs.project_name }}.yml
    - run: env
    - run: set
    - run: echo $GITHUB_ENV
    - run: echo $GITHUB_ENV

  jobs:
    needs: matrix
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      concurrency: 2
      matrix:
        project:
          - siag
          - ocs
          - traefik1
          - traefik2
          - traefik21
          - traefik22
          - traefik23
          - traefik24
          - traefik25
          - traefik26
          - traefik27
          - traefik28
          - traefik29
          - traefik20
          - traefik31
          - traefik32
          - traefik33
          - traefik34
          - traefik35
          - traefik36
          - traefik37
          - traefik38
          - traefik39
          - traefik30
    name: ${{ matrix.project }} Project
    steps:
      - run: hostname || true
