name: Release
on:
  workflow_call:

env:
  DOCKER_BUILDKIT: 1

jobs:
  matrix:
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.generate.outputs.matrix }}
    steps:
    - name: Setup
      run: echo ./utils/setup.sh
    - name: Generate matrix
      id: generate
      run: echo ${{ inputs.project_name }}.yml
    - run: env
    - run: set
    - run: echo $GITHUB_ENV
    - run: echo $GITHUB_ENV

  jobs:
    needs: matrix
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        project:
          - siag: name
          - ocs
          - traefik1
          - traefik2

    name: ${{ matrix.project }}/${{ matrix.siag.name }} | ${{ matrix.imgs }}
    steps:

    - name: ðŸš§ Build, test and release
      run: echo ./utils/build-test-release
